<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="stylesheet" href="style.css" />
    <title>Pokedex</title>
  </head>
  <body>
    <div class="section">
      <img src="pokeball.png" class="pokeball" />
      <h1 class="title">Pokedex</h1>

      <p class="parragraph">Escribe tu pokemon favorito! ╮(─▽─)╭</p>

      <form action="" id="formid">
        <input type="text" id="pokemonid" placeholder="Name" />

        <button type="submit" class="button" disabled>Search</button>
      </form>

      <div id="resultado">
        <div class="spiner ocultar">
          <div class="lds-ellipsis">
            <div></div>
            <div></div>
            <div></div>
            <div></div>
          </div>
        </div>
      </div>
    </div>

    <script>
      const form = document.getElementById('formid')
      const pokemonid = document.getElementById('pokemonid')
      const resultado = document.getElementById('resultado')

      const boton = document.getElementsByClassName('button')[0]

      // let spinner = document.createElement("div");
      // spinner.classList.add("lds-ellipsis");

      // spinner.innerHTML = `<div></div>
      //   <div></div>
      //   <div></div>
      //   <div></div>`;

      let loading = document.getElementsByClassName('spiner')[0]

      pokemonid.addEventListener('input', function(ev) {
        let length = ev.target.value.length
        if (length > 0) {
          boton.disabled = false
        } else {
          boton.disabled = true
        }

        console.log('')
      })

      function removerResultado() {
        let pokemonTitulo = document.getElementsByClassName('titlePokemon')[0],
          pokemonimage = document.getElementsByClassName('pokeimg')[0]

        if (pokemonTitulo && pokemonimage) {
          resultado.removeChild(pokemonTitulo)
          resultado.removeChild(pokemonimage)
        }
      }

      form.addEventListener('submit', function(evento) {
        evento.preventDefault()
        removerResultado()
        let pokemonTitulo = document.createElement('h2')
        pokemonTitulo.classList.add('titlePokemon')
        let pokemonimage = document.createElement('img')
        pokemonimage.classList.add('pokeimg')

        async function buscarNombre(nombre) {
          const pokemon = await fetch(
            `https://pokeapi.co/api/v2/pokemon/${nombre}`
          )

          loading.classList.toggle('ocultar')

          if (pokemon.ok && pokemon.status === 200) {
            loading.classList.toggle('ocultar')

            const pokemonData = await pokemon.json()
            const pokemonNombre = pokemonData.name
            const {
              name,
              sprites: { front_default },
            } = pokemonData

            pokemonTitulo.innerHTML = name
            pokemonimage.src = front_default

            console.log(pokemonData)
            console.log('todo bien')
          } else {
            console.log('error')

            let errorimg = document.createElement('img')
            errorimg.setAttribute(
              'src',
              'https://image.flaticon.com/icons/svg/391/391116.svg'
            )
            document.getElementById('resultado').appendChild(errorimg)
            document.querySelector(errorimg).style.width = '70px'
          }

          resultado.appendChild(pokemonTitulo)
          resultado.appendChild(pokemonimage)

          // resultado.onload = function() {};

          boton.addEventListener('click', function(ev) {
            pokeimg.classList.toggle('animation')
          })
          pokeimg.addEventListener('animationend', function(ev) {
            pokeimg.classList.toggle('animation')
          })
        }
        console.log(pokemonid.value)
        buscarNombre(pokemonid.value)
      })
    </script>
  </body>
</html>
